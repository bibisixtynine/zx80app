<!DOCTYPE html>

<html lang="en">
  <head>
    <title>An App</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="viewport-fit=cover,user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <link
      rel="apple-touch-icon"
      href="https://cdn.glitch.global/e73a15d2-2f8a-477d-80bc-a6e8167fe97a/application-512.png?v=1700949025274"
    />
    <link
      id="favicon"
      rel="icon"
      href="https://cdn.glitch.global/e73a15d2-2f8a-477d-80bc-a6e8167fe97a/application-512.png?v=1700949025274"
    />
    <meta name="theme-color" content="#f2b200" />

    <!-- manifest -->
    <link rel="manifest" href="manifest.json" />

    <style>
      body {
        font-family: monospace;
        background-color: black;
        color: #20ff20;
        margin: 0px;
        padding: 0px;
        /*padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);*/
        width: 100vw;
        height: 100vh;

      }
      #ui {
        position: fixed;
        width: 100vw;
        height: 100vh;
      }
      #console-messages {
        position: fixed;
        width: 100vw;
        height: 100vh;
      }
    </style>
    <script>
      console.log("‚ú®üöÄ Qwark V10 running");
      if (window.location.protocol == "https:") {
        console.log("üîí10 Running in https");
      } else if (
        window.location.protocol !== "https:" &&
        window.location.hostname !== "localhost" &&
        window.location.protocol !== "file:"
      ) {
        window.location.protocol = "https";
        console.log("üîí10 Enforcing https");
      } else {
        console.log("üõ†Ô∏è10 Running in localhost or file, not enforcing https");
      }
    </script>

    <!-- service worker -->
    <script>
      window.messageLog = ['HELLO','HOW ARE YOU']
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register('/phaser-basic/sw.js', { scope: '/phaser-basic/' })
          .then(function (registration) {
            console.log("+-> (1) üòç Service Worker registered", registration);
          /*
            if (registration.waiting) {
              // Si le service worker est en attente, rechargez la page
              window.location.reload();
            }
            */
            // √âcouter les mises √† jour du service worker
            registration.addEventListener("updatefound", function () {
              let newWorker = registration.installing;
              newWorker.addEventListener("statechange", function () {
                switch (newWorker.state) {
                  case "installed":
                    if (navigator.serviceWorker.controller) {
                      console.log(
                        "+-> (2) ‚ú® Nouvelle version du Service Worker disponible"
                      );
                      // Ici, vous pourriez notifier l'utilisateur ou rafra√Æchir automatiquement la page
                    } else {
                      console.log(
                        "+-> (2) üéâ Service Worker install√© pour la premi√®re fois"
                      );
                    }
                    break;

                  case "redundant":
                    console.error(
                      "!!! (-) üÜò Le nouveau Service Worker a √©t√© rejet√©"
                    );
                    break;
                }
              });
            });
          })
          .catch(function (error) {
            console.error(
              "!!! (-) üÜò Service Worker registration failed",
              error
            );
          });
      } else {
        console.warn("!!! (-) üÜò Service Worker not supported in this browser");
      }
    </script>
  </head>
  <body>
    <div id="ui"></div>
    <div id="console-messages">HELLO</div>
    <script type="module" src="app.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
          navigator.serviceWorker.ready.then((registration) => {
            // RECEPTION des messages du Service Worker :
            navigator.serviceWorker.addEventListener("message", (event) => {
              const message = event.data;
              if (message.type === "console-log") {
                displayConsoleMessage(message.text);
              }
            });
            // Envoie un message "ready" au service worker :
            registration.active.postMessage({ type: "ready" });
          });
        });
      
      // Affichage de message dans le div console
      function displayConsoleMessage(text) {
        const consoleMessagesDiv = document.getElementById("console-messages");
        const messageElement = document.createElement("div");
        // Utilisez innerHTML au lieu de textContent
        messageElement.innerHTML = text.replace(/\n/g, "<br>")
        consoleMessagesDiv.appendChild(messageElement);
      }
      </script>
  </body>
</html>
